# Synapse Docker

Quickly spin up a Synapse + Postgres in Docker for testing.

**DO NOT USE IN PRODUCTION**

The config generated by this script is intentionally insecure to make testing easier.

```bash
$ ./synapse-env-manager.sh help
Usage: /path/to/synapse-env-manager.sh <option>

Options:
    admin:      Create Synapse admin account (username: admin. password: admin).
    delete:     Delete the environment, Synapse/Postgres data, and config files.
    gencom:     Regenerate the Podman Compose file.
    genele:     Regenerate the Element Web config file.
    gensyn:     Regenerate the Synapse config and log config files.
    help:       This help text.
    rsa:        Restart all containers.
    rse:        Restart the Element Web container.
    rss:        Restart the Synapse container.
    setup:      Create, edit, (re)start the environment.
    stop:       Stop the environment without deleting it.

Note: rsa and setup will recreate all containers and remove orphaned
containers. Synapse/Postgres data is not deleted.
```

## Setup

Optionally copy `config.example.env` to `config.env` and edit as needed if you don't want to use defaults.

Install [yq](https://mikefarah.gitbook.io/yq/), docker, and docker-compose if you don't have them.

Run `./synapse-env-manager.sh setup` to generate the environment. This will also generate the needed config files.

The directories `postgres` and `synapse` and the files `docker-compose.yaml` and `elementConfig.json` will be created in
the directory where the `synapse-env-manager.sh` script is placed. If these already exists, you may loose data stored
in them.

It will take a minute after you create the database for Synapse to start properly as it restarts a few times while
Postgres initializes the database.

Use Element Web on <http://localhost:10000> or any Matrix client to access Synapse on homeserver URL
`http://localhost:8448`.

## Adminer

You can optionally set up [Adminer](https://www.adminer.org/) to manage Postgres from your browser. If you enabled this,
the Adminer web ui is accessible at <http://localhost:10001/>. System: `PostgreSQL`. Server: `postgres`.
Username/Database: `synapse`. Password: `password`.
